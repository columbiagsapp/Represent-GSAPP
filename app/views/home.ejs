<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<% include head %>


    <body id="home">
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <div class="gradient gradient-red"></div>

        <div id="repgsapp-wrapper" class="edit-page">

          <header>
            <% include header-top %>
            <% include header-bottom %>
          </header>

          <main>
            <div id="carousel">

            </div>

          </main>



        </div><!-- #repgsapp-wrapper -->


        <% include scripts %>
        <!-- jQuery UI (Custom Download containing only Widget and Effects Core) You can make your own at: http://jqueryui.com/download -->
        <script src="/javascript/vendor/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>

        <!-- Latest version (3.1.4) of jQuery Mouse Wheel by Brandon Aaron You will find it here: https://github.com/brandonaaron/jquery-mousewheel -->
      	<script src="/javascript/vendor/jquery.mousewheel.min.js" type="text/javascript"></script>

      	<!-- jQuery Kinectic (1.8.2) used for touch scrolling -->
      	<!-- https://github.com/davetayls/jquery.kinetic/ -->
      	<script src="/javascript/vendor/jquery.kinetic.min.js" type="text/javascript"></script>

      	<!-- Smooth Div Scroll 1.3 minified-->
      	<script src="/javascript/vendor/jquery.smoothdivscroll-1.3-min.js" type="text/javascript"></script>


        <script>

          // handler for greyscale images when window is resized
          $(window).on("resize", function() {
            $("#carousel .prev, #carousel .next").imggrayscale("resize");
          });

          //load images into current
          function loadImages(){
            // if images not loaded, go get them

              var current_program = $('#carousel .current').attr('data-program');


              $.get( "/api/get/program/" + current_program, function( data ) {

                for(var i = 0; i < data.images.length; i++){
                  $("#carousel ." + current_program).append('<li class="image"><img src="'+ data.images[i].content.images.standard_resolution.url +'"></li>');
                }

                $('#carousel .current').addClass('loaded');
              }); //end get
          }


          // handler for when user clicks previous image in carousel
          function clickPrev(){
            $('body').scrollTop(0)
            $('#carousel .next').removeClass('next').unbind('click').hide();

            if( $(this).prev().length > 0 ){
              var $prev = $(this).prev();
              $prev.addClass('prev').show();
              $prev.find('img').imggrayscale({hoverShowOrigin: true});
            }

            $('#carousel .current').removeClass('current').addClass('next').find('img').imggrayscale({hoverShowOrigin: true});

            $(this).removeClass('prev').addClass('current').unbind('click').find('img').imggrayscale("destroy");

            $('#carousel .prev').click(clickPrev);//end click function prev
            $('#carousel .next').click(clickNext);//end click function next

            // if images not loaded, go get them
            if( !$('#carousel .current').hasClass('loaded') ){
              loadImages();
            }//end if not loaded

          }//end function clickPrev()


          // handler for when user clicks next image in carousel
          function clickNext(){
            $('body').scrollTop(0)
            $('#carousel .prev').removeClass('prev').unbind('click').hide();

            if( $(this).next().length > 0 ){
              console.log('.next() > 0');
              var $next = $(this).next();
              $next.addClass('next').show();
              $next.find('img').imggrayscale({hoverShowOrigin: true});
            }

            $('#carousel .current').removeClass('current').addClass('prev').find('img').imggrayscale({hoverShowOrigin: true});

            $(this).removeClass('next').addClass('current').unbind('click').find('img').imggrayscale("destroy");

            $('#carousel .prev').click(clickPrev);//end click function prev
            $('#carousel .next').click(clickNext);//end click function next

            // if images not loaded, go get them
            if( !$('#carousel .current').hasClass('loaded') ){
              loadImages();
            }//end if not loaded

          }//end function clickNext()

          // initialize the programs nav and set up scrolling, etc.
          function initProgramNav(programs, start){
            for(var p = 0; p < programs.length; p++){
              var html = '';
              if(p == (start + 1)){
                html = '<a class="nav-program titles content highlight '+ programs[p] +'" href="#" target="_self">'+ programs[p] +'</a>';
              }else{
                html = '<a class="nav-program titles content '+ programs[p] +'" href="#" target="_self">'+ programs[p] +'</a>';
              }
              $('#nav2 .inside').append( html );
              console.log('appended; p = ' + p);
            }

            // init smoothDivScroll for nav
            $("#nav2 .inside").smoothDivScroll({
              hotSpotScrollingStep: 3, //default 15 pixels
              easingAfterHotSpotScrollingDistance: 5, // default 10 Pixels
              mousewheelScrolling: "horizontal", // vertical, horizontal, allDirections or empty (no mousewheel scrolling) String
			        mousewheelScrollingStep: 7, // default 70 Pixels
              autoScrollingMode: "" // always, onStart or empty (no auto scrolling) String

            });
          }//end initProgramNav()


          // initialize main carousel by randomly selecting a program to start with and placing it in the center by pulling all featured images from the DB
          function initCarousel(images, start){
            var programs = [];
            var end = start + 2;

            for(var i = 0; i < images.length; i++){
              programs.push( images[i].programs[0] );

              switch(i){
                case start:
                  console.log('i = start');
                  $("#carousel").append('<ul data-program="'+images[i].programs[0]+'" class="item prev '+ images[i].programs[0] +'"><li class="image featured"><img src="'+ images[i].content.images.standard_resolution.url +'"></li></ul>');
                  break;

                case (start + 1):
                  $("#carousel").append('<ul data-program="'+images[i].programs[0]+'" class="item current '+ images[i].programs[0] +'"><li class="image featured"><img src="'+ images[i].content.images.standard_resolution.url +'"></li></ul>');
                  break;

                case end:
                  $("#carousel").append('<ul data-program="'+images[i].programs[0]+'" class="item next '+ images[i].programs[0] +'"><li class="image featured"><img src="'+ images[i].content.images.standard_resolution.url +'"></li></ul>');
                  break;

                default:
                  $("#carousel").append('<ul data-program="'+images[i].programs[0]+'" style="display:none;" class="item '+ images[i].programs[0] +'"><li class="image featured"><img src="'+ images[i].content.images.standard_resolution.url +'"></li></ul>');
                  break;
              }//end switch
            }// end for

            // init greyscale effects on prev and next
            $('#carousel .prev').click(clickPrev).find('img').imggrayscale({hoverShowOrigin: true});;//end click function prev
            $('#carousel .next').click(clickNext).find('img').imggrayscale({hoverShowOrigin: true});;//end click function next

            return programs;
          }//end initCarouse()



          $(document).ready(function(){

            // dynamically load image content into custom carousel
            $.get( "/api/get/featured", function( images ) {

              // randomly select first program to center
              var start = Math.floor( Math.random()*(images.length-2) );

              // extract programs from array
              var programs = initCarousel(images, start);

              // populate programs nav (nav2)
              initProgramNav(programs, start);

              // load additional images into .current
              loadImages();

            });// end first get



          });
        </script>
    </body>
</html>
